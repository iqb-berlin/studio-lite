<div class="fx-column-start-stretch full-height comments-container">
  @if (isCommentProcessing) {
    <div class="spinner-container">
      <mat-spinner class="fx-flex-fix-100" ></mat-spinner>
    </div>
  }
  @if (!newCommentOnly) {
    <button class="filter-button" matFab
            [matMenuTriggerFor]="filterMenu">
      <mat-icon matBadgeOverlap="false"
                [matBadgeHidden]="!filteredItems.length"
                [matBadge]="filteredItems.length">filter_alt</mat-icon>
    </button>

    <mat-menu #filterMenu="matMenu"
              class="comments-filter-menu"
              [xPosition] = "'before'"
              [yPosition] = "'below'">
      <mat-selection-list [(ngModel)]="filteredItems">
        @for (item of unitItems; track item) {
          <mat-list-option togglePosition="before"
                           [value]="item.uuid"
                           (click)="$event.stopPropagation()">
            {{item.id ? item.id : ('metadata.without-id' | translate)}}
          </mat-list-option>
        }
      </mat-selection-list>
    </mat-menu>

    <div class="comments fx-flex-fill">
      @for (rootComment of (comments | filteredComments : filteredItems) | rootComments; track rootComment) {
        <studio-lite-comment
          [comment]="rootComment"
          [userId]="userId"
          [unitItems]="unitItems"
          [replies]="(comments | filteredComments : filteredItems) | replies: rootComment.id"
          [activeComment]="activeComment"
          [latestCommentId]="latestCommentId"
          [adminMode]="adminMode"
          (setActiveComment)="setActiveComment($event)"
          (addComment)="addComment($event)"
          (deleteComment)="deleteComment($event)"
          (updateComment)="updateComment($event)"
          studioLiteScrollCommentIntoView
          [id]="rootComment.id"
          [scrollTargetId]="latestCommentId">
        </studio-lite-comment>
      }
    </div>
  }

  <div class="new-comment">
    <studio-lite-comment-editor
      submitLabel="comment-editor.write"
      [unitItems]="unitItems"
      [placeholder]="'comments.write-comment' | translate"
      (handleSubmit)="addComment({ text: $event.text, parentId: null, items: $event.items })">
    </studio-lite-comment-editor>
  </div>
</div>
